# 1. 기본기 다지기 (1강 ~ 4강)

이 문서는 **전자정부 프레임워크의 환경 설정**, **Spring MVC의 핵심 동작 원리**, 그리고 **Controller와 View 간의 데이터 전달**에 대해 아주 상세하게 다룹니다.

---

## 1. 환경 설정 및 프로젝트 구조 (1강 ~ 2강)

### 1.1 프로젝트 디렉토리 구조
전자정부 프레임워크(Spring) 프로젝트는 정해진 폴더 구조를 따릅니다.

*   `src/main/java`: 자바 소스 코드 (`.java`)
    *   `egovframework.example.sample.web`: **Controller** (웹 요청 처리)
    *   `egovframework.example.sample.service`: **Service** (비즈니스 로직), **VO** (Value Object)
    *   `egovframework.example.sample.service.impl`: **Service 구현체**, **DAO 구현체** (데이터 접근)
*   `src/main/resources`: 설정 파일 및 SQL (`.xml`, `.properties`)
    *   `egovframework/spring`: Spring 설정 파일 (`context-*.xml`)
    *   `egovframework/sqlmap`: MyBatis SQL 파일 (`*.xml`)
*   `src/main/webapp`: 웹 리소스
    *   `WEB-INF/jsp`: JSP 파일 (사용자에게 보여질 화면)
    *   `WEB-INF/web.xml`: 웹 애플리케이션 설정 (서블릿, 필터 등)

### 1.2 Maven 설정 (`pom.xml`)
프로젝트에서 사용하는 라이브러리를 관리합니다.

```xml
<!-- Spring Framework 버전 설정 -->
<properties>
    <spring.maven.artifact.version>5.3.6</spring.maven.artifact.version>
    <egovframework.rte.version>4.0.0</egovframework.rte.version>
</properties>

<dependencies>
    <!-- 전자정부 프레임워크 실행환경 (RTE) -->
    <dependency>
        <groupId>egovframework.rte</groupId>
        <artifactId>egovframework.rte.ptl.mvc</artifactId>
        <version>${egovframework.rte.version}</version>
    </dependency>
    <!-- Spring Web MVC -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-webmvc</artifactId>
        <version>${spring.maven.artifact.version}</version>
    </dependency>
    <!-- JSTL (JSP 태그 라이브러리) -->
    <!-- 참고: Tomcat 10 이상 사용 시 javax.servlet -> jakarta.servlet 변경 필요 (Tomcat 9 권장) -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>jstl</artifactId>
        <version>1.2</version>
    </dependency>
</dependencies>
```

---

## 2. Spring MVC 패턴 상세 분석 (3강)

사용자의 요청이 들어와서 응답이 나갈 때까지의 **모든 과정**을 이해해야 합니다.

### 2.1 핵심 흐름 (Request Lifecycle)
1.  **Client**: 브라우저에서 `http://.../egovSampleList.do` 요청.
2.  **DispatcherServlet**: `web.xml` 설정을 보고 모든 `*.do` 요청을 가로챔.
3.  **HandlerMapping**: 요청 URL(`/egovSampleList.do`)을 처리할 **Controller**(`EgovSampleController`)를 찾음.
4.  **Controller**: 비즈니스 로직(Service)을 호출하고, 결과 데이터(`Model`)와 다음 페이지 정보(`View Name`)를 리턴.
5.  **ViewResolver**: Controller가 준 View Name(`sample/egovSampleList`)을 실제 JSP 경로(`/WEB-INF/jsp/.../egovSampleList.jsp`)로 변환.
6.  **View (JSP)**: Model 데이터를 사용하여 HTML을 생성.
7.  **DispatcherServlet**: 생성된 HTML을 Client에게 응답.

### 2.2 설정 파일 분석

**1) `web.xml` (서블릿 컨테이너 설정)**
가장 먼저 읽히는 파일입니다. `DispatcherServlet`을 등록합니다.

```xml
<!-- 한글 깨짐 방지 필터 -->
<filter>
    <filter-name>encodingFilter</filter-name>
    <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>utf-8</param-value>
    </init-param>
</filter>

<!-- DispatcherServlet 등록 (이름: action) -->
<servlet>
    <servlet-name>action</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <!-- Spring 설정 파일 위치 지정 -->
        <param-name>contextConfigLocation</param-name>
        <param-value>/WEB-INF/config/egovframework/springmvc/egov-com-servlet.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>

<!-- *.do 요청은 전부 action 서블릿이 처리해라 -->
<servlet-mapping>
    <servlet-name>action</servlet-name>
    <url-pattern>*.do</url-pattern>
</servlet-mapping>
```

**2) `egov-com-servlet.xml` (Spring MVC 설정)**
`DispatcherServlet`이 참고하는 설정 파일입니다.

```xml
<!-- Controller 스캔: 이 패키지 밑에 있는 @Controller 붙은 애들을 다 찾아라 -->
<context:component-scan base-package="egovframework">
    <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"/>
</context:component-scan>

<!-- ViewResolver: 뷰 이름 앞뒤에 경로와 확장자를 붙여라 -->
<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
    <property name="prefix" value="/WEB-INF/jsp/egovframework/example/"/>
    <property name="suffix" value=".jsp"/>
</bean>
```

---

## 3. 데이터 전달 (4강)

Controller에서 JSP로, 또는 JSP에서 Controller로 데이터를 주고받는 방법입니다.

### 3.1 Controller -> JSP (Model 객체 사용)
`Model`은 `Map`처럼 Key-Value 쌍으로 데이터를 저장하는 객체입니다.

```java
@Controller
public class SampleController {

    @RequestMapping("/list.do")
    public String list(Model model) {
        
        // 1. 단순 문자열 전달
        model.addAttribute("msg", "안녕하세요!");
        
        // 2. 리스트(객체) 전달
        List<String> fruits = Arrays.asList("사과", "바나나", "포도");
        model.addAttribute("fruitList", fruits);
        
        return "sample/list"; // -> /WEB-INF/jsp/.../sample/list.jsp
    }
}
```

### 3.2 JSP -> Controller (Command Object 사용)
사용자가 폼(Form)에 입력한 데이터를 자바 객체(VO)로 한 번에 받을 수 있습니다.

**JSP (Form)**
```jsp
<form action="register.do" method="post">
    이름: <input type="text" name="name" /> <br/>
    나이: <input type="text" name="age" /> <br/>
    <input type="submit" value="전송" />
</form>
```

**Java (VO)**
```java
public class UserVO {
    private String name;
    private int age;
    // Getter, Setter 필수!
}
```

**Controller**
```java
@RequestMapping("/register.do")
public String register(UserVO userVO) {
    // input name="name" 값이 userVO.setName()으로 자동 주입됨
    System.out.println("이름: " + userVO.getName());
    System.out.println("나이: " + userVO.getAge());
    
    return "sample/result";
}
```

### 3.3 JSP에서 데이터 출력 (JSTL/EL)
Controller가 `model.addAttribute("fruitList", list)`로 보낸 데이터를 화면에 뿌립니다.

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<h1>${msg}</h1> <!-- "안녕하세요!" 출력 -->

<ul>
    <!-- fruitList를 반복문 돌려서 하나씩 item 변수에 담음 -->
    <c:forEach var="item" items="${fruitList}" varStatus="status">
        <li>
            번호: ${status.count} - 과일: ${item}
        </li>
    </c:forEach>
</ul>
```

---

### 요약
1.  **설정**: `web.xml`은 문지기(`DispatcherServlet`)를 세우고, `egov-com-servlet.xml`은 일꾼(`Controller`)과 지도(`ViewResolver`)를 관리한다.
2.  **흐름**: 요청 -> Dispatcher -> Controller -> Service -> DAO -> DB -> Controller -> JSP -> 응답.
3.  **데이터**: 갈 때는 `Model`에 담고, 올 때는 `VO(Command Object)`로 받는다.
